<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cashier Tracker</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; background:#f5f6f8; margin:0; padding:24px; }
    h1 { margin-bottom:16px; }
    .card { background:white; border-radius:14px; padding:16px; margin-bottom:16px; box-shadow:0 4px 12px rgba(0,0,0,.06); }
    label { font-size:14px; display:block; margin-bottom:4px; }
    input { padding:8px; width:100%; border-radius:10px; border:1px solid #ccc; margin-bottom:10px; }
    button { padding:10px 14px; border-radius:14px; border:0; cursor:pointer; background:#111; color:white; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:10px; text-align:left; border-bottom:1px solid #e5e5e5; }
    th { font-size:13px; }
    .row-small { font-size:13px; }
    .two-col { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .summary-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; }
    .pill { background:#f2f2f2; border-radius:12px; padding:8px; text-align:center; }
    .input-with-btn { position:relative; }
    .zero-btn { position:absolute; right:8px; top:32px; padding:4px 10px; font-size:12px; background:#4CAF50; border-radius:8px; cursor:pointer; }
  </style>
</head>
<body>
  <h1>Cashier Tracker</h1>

  <div class="card">
    <form id="txForm">
      <div class="two-col">
        <div class="input-with-btn">
          <label>Amount To Pay</label>
          <input type="number" id="amountDue" placeholder="0" required />
          <button type="button" class="zero-btn" onclick="addZeros('amountDue')">+000</button>
        </div>
        <div class="input-with-btn">
          <label>Amount Received</label>
          <input type="number" id="amountPaid" placeholder="0" required />
          <button type="button" class="zero-btn" onclick="addZeros('amountPaid')">+000</button>
        </div>
      </div>
      <label>Note (optional)</label>
      <input type="text" id="note" placeholder="Item / reason" />
      <button type="submit">Add Transaction</button>
      <div id="changeInfo" class="pill" style="margin-top:10px"></div>
    </form>
  </div>

  <div class="card">
    <h3>Today Summary</h3>
    <div class="summary-grid">
      <div class="pill">Transactions<br><strong id="sumCount">0</strong></div>
      <div class="pill">Total Due<br><strong id="sumDue">0</strong> IQD</div>
      <div class="pill">Total Paid<br><strong id="sumPaid">0</strong> IQD</div>
      <div class="pill">Change Returned<br><strong id="sumChange">0</strong> IQD</div>
    </div>
  </div>

  <div class="card">
    <h3>Transactions</h3>
    <table>
      <thead>
        <tr>
          <th>Time</th>
          <th>Due (IQD)</th>
          <th>Paid (IQD)</th>
          <th>Change (IQD)</th>
          <th>Note</th>
          <th>Edit</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody id="txBody"></tbody>
    </table>
  </div>

  <script>
    const LS_KEY = "cashier_transactions_v1";
    const txBody = document.getElementById("txBody");
    let editingId = null;

    function addZeros(fieldId) {
      const field = document.getElementById(fieldId);
      const currentValue = field.value || "0";
      field.value = currentValue + "000";
    }

    function loadTx() {
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || []; }
      catch(e) { return []; }
    }

    function saveTx(list) {
      localStorage.setItem(LS_KEY, JSON.stringify(list));
    }

    function isToday(date) {
      const d = new Date(date);
      const n = new Date();
      return d.getDate() === n.getDate() && d.getMonth() === n.getMonth() && d.getFullYear() === n.getFullYear();
    }

    function deleteTx(id) {
      if (confirm("Are you sure you want to delete this transaction?")) {
        const list = loadTx();
        const filtered = list.filter(tx => tx.id !== id);
        saveTx(filtered);
        render();
      }
    }

    function editTx(id) {
      const list = loadTx();
      const tx = list.find(t => t.id === id);
      if (tx) {
        document.getElementById("amountDue").value = tx.amountDue;
        document.getElementById("amountPaid").value = tx.amountPaid;
        document.getElementById("note").value = tx.note || "";
        editingId = id;
        document.querySelector("#txForm button[type='submit']").textContent = "Update Transaction";
        document.getElementById("changeInfo").textContent = "";
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    function cancelEdit() {
      editingId = null;
      document.getElementById("amountDue").value = "";
      document.getElementById("amountPaid").value = "";
      document.getElementById("note").value = "";
      document.querySelector("#txForm button[type='submit']").textContent = "Add Transaction";
      document.getElementById("changeInfo").textContent = "";
    }

    function render() {
      const list = loadTx();
      txBody.innerHTML = "";

      let sumCount = 0, sumDue = 0, sumPaid = 0, sumChange = 0;

      list.slice().reverse().forEach(tx => {
        const tr = document.createElement("tr");
        tr.className = "row-small";
        tr.innerHTML = `
          <td>${new Date(tx.time).toLocaleString()}</td>
          <td>${tx.amountDue}</td>
          <td>${tx.amountPaid}</td>
          <td>${tx.change}</td>
          <td>${tx.note || ""}</td>
          <td><button onclick="editTx(${tx.id})" style="padding:4px 8px; font-size:12px; background:#007bff;">Edit</button></td>
          <td><button onclick="deleteTx(${tx.id})" style="padding:4px 8px; font-size:12px; background:#dc3545;">Delete</button></td>`;
        txBody.appendChild(tr);

        if (isToday(tx.time)) {
          sumCount += 1;
          sumDue += tx.amountDue;
          sumPaid += tx.amountPaid;
          sumChange += tx.change;
        }
      });

      document.getElementById("sumCount").textContent = sumCount;
      document.getElementById("sumDue").textContent = sumDue;
      document.getElementById("sumPaid").textContent = sumPaid;
      document.getElementById("sumChange").textContent = sumChange;
    }

    document.getElementById("txForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const amountDue = Number(document.getElementById("amountDue").value || 0);
      const amountPaid = Number(document.getElementById("amountPaid").value || 0);
      const note = document.getElementById("note").value.trim();

      const change = amountPaid - amountDue;
      const info = document.getElementById("changeInfo");
      info.textContent = `Change: ${change} IQD`;

      const list = loadTx();
      
      if (editingId !== null) {
        // Update existing transaction
        const index = list.findIndex(tx => tx.id === editingId);
        if (index !== -1) {
          list[index] = {
            ...list[index],
            amountDue,
            amountPaid,
            change,
            note
          };
        }
        editingId = null;
        document.querySelector("#txForm button[type='submit']").textContent = "Add Transaction";
      } else {
        // Add new transaction
        list.push({
          id: Date.now(),
          time: new Date().toISOString(),
          amountDue,
          amountPaid,
          change,
          note
        });
      }

      saveTx(list);
      render();

      document.getElementById("amountDue").value = "";
      document.getElementById("amountPaid").value = "";
      document.getElementById("note").value = "";
    });

    render();
  </script>
</body>
</html>
