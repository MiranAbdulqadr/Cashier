<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cashier Tracker</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, Arial, Helvetica, sans-serif; 
      background:#f5f6f8; 
      margin:0; 
      padding:16px; 
      -webkit-font-smoothing: antialiased;
    }
    h1 { margin-bottom:16px; font-size:24px; }
    h3 { margin-top:0; margin-bottom:12px; font-size:18px; }
    .card { 
      background:white; 
      border-radius:16px; 
      padding:16px; 
      margin-bottom:16px; 
      box-shadow:0 2px 8px rgba(0,0,0,.08); 
    }
    label { font-size:15px; display:block; margin-bottom:6px; font-weight:500; }
    input { 
      padding:14px; 
      width:100%; 
      border-radius:12px; 
      border:1px solid #d0d0d0; 
      margin-bottom:12px; 
      font-size:16px;
      -webkit-appearance: none;
    }
    input:focus { outline:none; border-color:#007AFF; }
    button { 
      padding:14px 18px; 
      border-radius:12px; 
      border:0; 
      cursor:pointer; 
      background:#111; 
      color:white; 
      font-size:16px;
      font-weight:600;
      width:100%;
      -webkit-tap-highlight-color: transparent;
    }
    button:active { opacity:0.8; }
    .table-wrapper { overflow-x:auto; -webkit-overflow-scrolling:touch; }
    table { width:100%; border-collapse:collapse; min-width:600px; }
    th, td { padding:12px 8px; text-align:left; border-bottom:1px solid #e5e5e5; white-space:nowrap; }
    th { font-size:13px; font-weight:600; color:#666; }
    .row-small { font-size:14px; }
    .two-col { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .summary-grid { 
      display:grid; 
      grid-template-columns:repeat(2,1fr); 
      gap:10px; 
    }
    .pill { 
      background:#f8f9fa; 
      border-radius:12px; 
      padding:14px 10px; 
      text-align:center; 
      font-size:13px;
      line-height:1.4;
    }
    .pill strong { display:block; font-size:20px; margin-top:4px; color:#111; }
    .input-with-btn { position:relative; }
    .zero-btn { 
      position:absolute; 
      right:10px; 
      top:38px; 
      padding:8px 12px; 
      font-size:14px; 
      background:#34C759; 
      border-radius:10px; 
      cursor:pointer; 
      font-weight:600;
      color:white;
      border:0;
      width:auto;
      -webkit-tap-highlight-color: transparent;
    }
    .zero-btn:active { opacity:0.8; }
    .quick-add-btns {
      display:grid;
      grid-template-columns:repeat(4, 1fr);
      gap:8px;
      margin-bottom:12px;
    }
    .quick-btn {
      padding:12px 8px;
      font-size:14px;
      background:#34C759;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      color:white;
      border:0;
      -webkit-tap-highlight-color: transparent;
    }
    .quick-btn:active { opacity:0.8; }
    .action-btn {
      padding:8px 12px !important;
      font-size:14px !important;
      font-weight:600 !important;
      border-radius:8px !important;
      min-width:60px;
      width:auto !important;
    }
    .edit-btn { background:#007AFF !important; }
    .delete-btn { background:#FF3B30 !important; }
    th:nth-last-child(-n+2), td:nth-last-child(-n+2) { text-align:center; }
    .history-btn {
      background:#5856D6 !important;
      margin-top:12px;
    }
    .modal {
      display:none;
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.5);
      z-index:1000;
      overflow-y:auto;
      padding:20px;
    }
    .modal.show { display:flex; align-items:flex-start; justify-content:center; }
    .modal-content {
      background:white;
      border-radius:16px;
      padding:20px;
      max-width:800px;
      width:100%;
      margin:40px auto;
      box-shadow:0 4px 20px rgba(0,0,0,0.2);
    }
    .modal-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:20px;
    }
    .modal-header h2 { margin:0; font-size:22px; }
    .close-btn {
      background:#f0f0f0 !important;
      color:#111 !important;
      padding:8px 16px !important;
      font-size:14px !important;
      width:auto !important;
    }
    .day-card {
      background:#f8f9fa;
      border-radius:12px;
      padding:16px;
      margin-bottom:12px;
    }
    .day-card h4 { margin:0 0 12px 0; font-size:16px; color:#111; }
    .day-stats {
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));
      gap:8px;
      font-size:14px;
    }
    .stat-item { padding:8px; background:white; border-radius:8px; }
    .stat-item strong { display:block; font-size:16px; color:#111; margin-top:2px; }
    
    .day-0 { background-color: #c1121f; color: white; } /* Sunday - Light Red */
    .day-1 { background-color: #386641; color: white; } /* Monday - Light Orange */
    .day-2 { background-color: #ffc300; color: white; } /* Tuesday - Light Yellow */
    .day-3 { background-color: #7209b7; color: white; } /* Wednesday - Light Green */
    .day-4 { background-color: #006d77; color: white; } /* Thursday - Light Blue */
    .day-5 { background-color: #f72585; color: white; } /* Friday - Light Purple */
    .day-6 { background-color: #03045e; color: white; } /* Saturday - Light Pink */
    
    @media (max-width: 480px) {
      body { padding:12px; }
      h1 { font-size:22px; }
      .summary-grid { grid-template-columns:1fr; }
      .pill { padding:12px; }
      table { font-size:13px; }
      th, td { padding:10px 6px; }
    }
    
  
  </style>
</head>
<body>
  <h1>Cashier Tracker</h1>

  <div class="card">
    <form id="txForm">
      <div class="input-with-btn">
        <label>Amount To Pay</label>
        <input type="number" id="amountDue" placeholder="0" required />
      </div>
      <div class="quick-add-btns">
        <button type="button" class="quick-btn" onclick="addToAmount(1000)">+1,000</button>
        <button type="button" class="quick-btn" onclick="addToAmount(2000)">+2,000</button>
        <button type="button" class="quick-btn" onclick="addToAmount(3000)">+3,000</button>
          <button type="button" class="quick-btn" onclick="addToAmount(4000)">+4,000</button>
        <button type="button" class="quick-btn" onclick="addToAmount(5000)">+5,000</button>
        <button type="button" class="quick-btn" onclick="addToAmount(10000)">+10,000</button>
        <button type="button" class="quick-btn" onclick="addToAmount(25000)">+25,000</button>
        <button type="button" class="quick-btn" onclick="addToAmount(50000)">+50,000</button>
         <button type="button" class="quick-btn" onclick="resetAmount()" style="background:#FF3B30;">Reset</button>
        <button type="button" class="quick-btn" onclick="addToAmount(250)">+250</button>
        <button type="button" class="quick-btn" onclick="addToAmount(500)">+500</button>
        <button type="button" class="quick-btn" onclick="addToAmount(750)">+750</button>
       
      </div>


      <label>Note (optional)</label>
      <input type="text" id="note" placeholder="Item / reason" />
      <button type="submit">Add Transaction</button>
      <div id="changeInfo" class="pill" style="margin-top:10px"></div>
    </form>
  </div>

  <div class="card">
    <h3>Today Summary</h3>
    <div class="summary-grid">
      <div class="pill">Transactions<br><strong id="sumCount">0</strong></div>
      <div class="pill">Total Due<br><strong id="sumDue">0</strong> IQD</div>
    </div>
    <button class="history-btn" onclick="showHistory()">View History</button>
  </div>

  <div id="historyModal" class="modal" onclick="closeHistoryOnOutside(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2>Daily History</h2>
        <button class="close-btn" onclick="closeHistory()">Close</button>
      </div>
      <div id="historyContent"></div>
    </div>
  </div>

  <div class="card">
    <h3>Transactions</h3>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Time</th>
            <th>Due (IQD)</th>
            <th>Note</th>
            <th>Edit</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody id="txBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const LS_KEY = "cashier_transactions_v1";
    const txBody = document.getElementById("txBody");
    let editingId = null;

    function addZeros(fieldId) {
      const field = document.getElementById(fieldId);
      const currentValue = field.value || "0";
      field.value = currentValue + "000";
    }

    function resetAmount() {
      const field = document.getElementById("amountDue");
      field.value = "";
    }

    function addToAmount(value) {
      const field = document.getElementById("amountDue");
      const currentValue = parseFloat(field.value) || 0;
      field.value = currentValue + value;
    }

    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // Add Tab key listener for amountDue field
    document.getElementById("amountDue").addEventListener("keydown", function(e) {
      if (e.key === "Tab") {
        e.preventDefault();
        addZeros("amountDue");
      }
    });

    function loadTx() {
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || []; }
      catch(e) { return []; }
    }

    function saveTx(list) {
      localStorage.setItem(LS_KEY, JSON.stringify(list));
    }

    function isToday(date) {
      const d = new Date(date);
      const n = new Date();
      return d.getDate() === n.getDate() && d.getMonth() === n.getMonth() && d.getFullYear() === n.getFullYear();
    }

    function deleteTx(id) {
      if (confirm("Are you sure you want to delete this transaction?")) {
        const list = loadTx();
        const filtered = list.filter(tx => tx.id !== id);
        saveTx(filtered);
        render();
      }
    }

    function editTx(id) {
      const list = loadTx();
      const tx = list.find(t => t.id === id);
      if (tx) {
        document.getElementById("amountDue").value = tx.amountDue;
        document.getElementById("note").value = tx.note || "";
        editingId = id;
        document.querySelector("#txForm button[type='submit']").textContent = "Update Transaction";
        document.getElementById("changeInfo").textContent = "";
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    function cancelEdit() {
      editingId = null;
      document.getElementById("amountDue").value = "";
      document.getElementById("note").value = "";
      document.querySelector("#txForm button[type='submit']").textContent = "Add Transaction";
      document.getElementById("changeInfo").textContent = "";
    }

    function render() {
      const list = loadTx();
      txBody.innerHTML = "";

      let sumCount = 0, sumDue = 0;

      list.slice().reverse().forEach(tx => {
        const tr = document.createElement("tr");
        const dayOfWeek = new Date(tx.time).getDay();
        tr.className = `row-small day-${dayOfWeek}`;
        tr.innerHTML = `
          <td>${new Date(tx.time).toLocaleString()}</td>
          <td>${formatNumber(tx.amountDue)}</td>
          <td>${tx.note || ""}</td>
          <td><button onclick="editTx(${tx.id})" class="action-btn edit-btn">Edit</button></td>
          <td><button onclick="deleteTx(${tx.id})" class="action-btn delete-btn">Delete</button></td>`;
        txBody.appendChild(tr);

        if (isToday(tx.time)) {
          sumCount += 1;
          sumDue += tx.amountDue;
        }
      });

      document.getElementById("sumCount").textContent = sumCount;
      document.getElementById("sumDue").textContent = formatNumber(sumDue);
    }

    document.getElementById("txForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const amountDue = Number(document.getElementById("amountDue").value || 0);
      const note = document.getElementById("note").value.trim();

      const info = document.getElementById("changeInfo");
      info.textContent = `Amount: ${formatNumber(amountDue)} IQD`;

      const list = loadTx();
      
      if (editingId !== null) {
        // Update existing transaction
        const index = list.findIndex(tx => tx.id === editingId);
        if (index !== -1) {
          list[index] = {
            ...list[index],
            amountDue,
            note
          };
        }
        editingId = null;
        document.querySelector("#txForm button[type='submit']").textContent = "Add Transaction";
      } else {
        // Add new transaction
        list.push({
          id: Date.now(),
          time: new Date().toISOString(),
          amountDue,
          amountPaid: 0,
          change: 0,
          note
        });
      }

      saveTx(list);
      render();

      document.getElementById("amountDue").value = "";
      document.getElementById("note").value = "";
    });

    function showHistory() {
      const list = loadTx();
      const historyContent = document.getElementById("historyContent");
      
      if (list.length === 0) {
        historyContent.innerHTML = '<p style="text-align:center;color:#666;padding:20px;">No transactions yet.</p>';
        document.getElementById("historyModal").classList.add("show");
        return;
      }
      
      // Group transactions by date
      const groupedByDate = {};
      list.forEach(tx => {
        const date = new Date(tx.time);
        const dateKey = date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        
        if (!groupedByDate[dateKey]) {
          groupedByDate[dateKey] = {
            date: date,
            transactions: [],
            count: 0,
            totalDue: 0
          };
        }
        
        groupedByDate[dateKey].transactions.push(tx);
        groupedByDate[dateKey].count += 1;
        groupedByDate[dateKey].totalDue += tx.amountDue;
      });
      
      // Sort by date descending
      const sortedDates = Object.keys(groupedByDate).sort((a, b) => {
        return groupedByDate[b].date - groupedByDate[a].date;
      });
      
      // Build HTML
      let html = '';
      sortedDates.forEach(dateKey => {
        const day = groupedByDate[dateKey];
        html += `
          <div class="day-card">
            <h4>${dateKey}</h4>
            <div class="day-stats">
              <div class="stat-item">
                <span>Transactions</span>
                <strong>${day.count}</strong>
              </div>
              <div class="stat-item">
                <span>Total Due</span>
                <strong>${formatNumber(day.totalDue)} IQD</strong>
              </div>
            </div>
          </div>
        `;
      });
      
      historyContent.innerHTML = html;
      document.getElementById("historyModal").classList.add("show");
    }
    
    function closeHistory() {
      document.getElementById("historyModal").classList.remove("show");
    }
    
    function closeHistoryOnOutside(event) {
      if (event.target.id === "historyModal") {
        closeHistory();
      }
    }

    render();
  </script>
</body>
</html>
